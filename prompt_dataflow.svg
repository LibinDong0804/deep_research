<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1600 2400" width="1600" height="2400">
  <defs>
    <!-- æ¸å˜å®šä¹‰ -->
    <linearGradient id="promptGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#667eea"/>
      <stop offset="100%" style="stop-color:#764ba2"/>
    </linearGradient>
    <linearGradient id="inputGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#43e97b"/>
      <stop offset="100%" style="stop-color:#38f9d7"/>
    </linearGradient>
    <linearGradient id="outputGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#fa709a"/>
      <stop offset="100%" style="stop-color:#fee140"/>
    </linearGradient>
    <linearGradient id="llmGrad" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#f093fb"/>
      <stop offset="100%" style="stop-color:#f5576c"/>
    </linearGradient>

    <!-- é˜´å½± -->
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="2" dy="2" stdDeviation="3" flood-opacity="0.15"/>
    </filter>

    <!-- ç®­å¤´ -->
    <marker id="arrow" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#667eea"/>
    </marker>
    <marker id="arrow-green" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#38f9d7"/>
    </marker>
    <marker id="arrow-orange" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#fa709a"/>
    </marker>
    <marker id="arrow-red" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#ef4444"/>
    </marker>
  </defs>

  <!-- èƒŒæ™¯ -->
  <rect width="1600" height="2400" fill="#f8fafc"/>

  <!-- æ ‡é¢˜ -->
  <rect x="50" y="20" width="1500" height="80" rx="10" fill="url(#promptGrad)" filter="url(#shadow)"/>
  <text x="800" y="55" text-anchor="middle" fill="white" font-size="28" font-family="Arial, sans-serif" font-weight="bold">
    Deep Research Agent - Prompt æ•°æ®æµè½¬è¯¦è§£
  </text>
  <text x="800" y="80" text-anchor="middle" fill="#e0e7ff" font-size="14" font-family="Arial, sans-serif">
    æ¯ä¸ª Prompt çš„è¾“å…¥å˜é‡æ¥æº â†’ LLMå¤„ç† â†’ è¾“å‡ºç»“æœ â†’ ä¼ é€’ç»™ä¸‹ä¸€æ­¥
  </text>

  <!-- å›¾ä¾‹ -->
  <g transform="translate(1200, 120)">
    <rect x="0" y="0" width="320" height="100" rx="8" fill="white" stroke="#e5e7eb" stroke-width="1"/>
    <text x="160" y="25" text-anchor="middle" fill="#374151" font-size="14" font-family="Arial, sans-serif" font-weight="bold">å›¾ä¾‹</text>
    <rect x="20" y="40" width="60" height="20" rx="4" fill="url(#inputGrad)"/>
    <text x="90" y="55" fill="#374151" font-size="12" font-family="Arial, sans-serif">è¾“å…¥å˜é‡</text>
    <rect x="170" y="40" width="60" height="20" rx="4" fill="url(#outputGrad)"/>
    <text x="240" y="55" fill="#374151" font-size="12" font-family="Arial, sans-serif">è¾“å‡ºç»“æœ</text>
    <rect x="20" y="70" width="60" height="20" rx="4" fill="url(#promptGrad)"/>
    <text x="90" y="85" fill="#374151" font-size="12" font-family="Arial, sans-serif">Promptæ¨¡æ¿</text>
    <rect x="170" y="70" width="60" height="20" rx="4" fill="url(#llmGrad)"/>
    <text x="240" y="85" fill="#374151" font-size="12" font-family="Arial, sans-serif">LLMå¤„ç†</text>
  </g>

  <!-- ==================== STEP 1: ç”¨æˆ·è¾“å…¥ ==================== -->
  <g transform="translate(50, 130)">
    <rect x="0" y="0" width="1100" height="80" rx="10" fill="#ecfdf5" stroke="#10b981" stroke-width="2" filter="url(#shadow)"/>
    <text x="30" y="35" fill="#047857" font-size="18" font-family="Arial, sans-serif" font-weight="bold">STEP 0: ç”¨æˆ·è¾“å…¥</text>
    <rect x="30" y="50" width="200" height="25" rx="4" fill="#10b981"/>
    <text x="130" y="68" text-anchor="middle" fill="white" font-size="13" font-family="monospace">task (ç ”ç©¶ä»»åŠ¡æè¿°)</text>
    <text x="250" y="68" fill="#065f46" font-size="12" font-family="Arial, sans-serif">
      ä¾‹: "2024å¹´ä¸­å›½æ–°èƒ½æºæ±½è½¦å¸‚åœºåˆ†ææŠ¥å‘Š"
    </text>
  </g>

  <!-- è¿æ¥çº¿ -->
  <line x1="180" y1="210" x2="180" y2="250" stroke="#10b981" stroke-width="2" marker-end="url(#arrow-green)"/>

  <!-- ==================== STEP 1: TASK_DECOMPOSITION_PROMPT ==================== -->
  <g transform="translate(50, 260)">
    <rect x="0" y="0" width="1500" height="260" rx="10" fill="white" stroke="#667eea" stroke-width="2" filter="url(#shadow)"/>

    <!-- æ ‡é¢˜ -->
    <rect x="0" y="0" width="1500" height="40" rx="10" fill="url(#promptGrad)"/>
    <text x="30" y="28" fill="white" font-size="16" font-family="Arial, sans-serif" font-weight="bold">
      STEP 1: TASK_DECOMPOSITION_PROMPT (ä»»åŠ¡åˆ†è§£)
    </text>
    <text x="1200" y="28" fill="#e0e7ff" font-size="12" font-family="monospace">orchestrator.decompose_task()</text>

    <!-- è¾“å…¥åŒºåŸŸ -->
    <rect x="20" y="55" width="400" height="90" rx="8" fill="#ecfdf5" stroke="#10b981" stroke-width="1"/>
    <text x="40" y="78" fill="#047857" font-size="14" font-family="Arial, sans-serif" font-weight="bold">ğŸ“¥ è¾“å…¥å˜é‡</text>
    <rect x="40" y="90" width="100" height="22" rx="4" fill="url(#inputGrad)"/>
    <text x="90" y="106" text-anchor="middle" fill="#065f46" font-size="11" font-family="monospace">{task}</text>
    <text x="150" y="106" fill="#374151" font-size="11" font-family="Arial, sans-serif">â† ç”¨æˆ·åŸå§‹ä»»åŠ¡æè¿°</text>
    <text x="40" y="135" fill="#6b7280" font-size="11" font-family="Arial, sans-serif">æ¥æº: ç”¨æˆ·è¾“å…¥ (STEP 0)</text>

    <!-- LLMå¤„ç† -->
    <rect x="460" y="55" width="200" height="90" rx="8" fill="url(#llmGrad)"/>
    <text x="560" y="90" text-anchor="middle" fill="white" font-size="14" font-family="Arial, sans-serif" font-weight="bold">ğŸ¤– LLM å¤„ç†</text>
    <text x="560" y="115" text-anchor="middle" fill="#fce7f3" font-size="11" font-family="Arial, sans-serif">åˆ†æä»»åŠ¡ç›®æ ‡</text>
    <text x="560" y="132" text-anchor="middle" fill="#fce7f3" font-size="11" font-family="Arial, sans-serif">æ‹†è§£ä¸º3-8ä¸ªå­ä»»åŠ¡</text>

    <!-- ç®­å¤´ -->
    <line x1="420" y1="100" x2="455" y2="100" stroke="#667eea" stroke-width="2" marker-end="url(#arrow)"/>
    <line x1="660" y1="100" x2="695" y2="100" stroke="#fa709a" stroke-width="2" marker-end="url(#arrow-orange)"/>

    <!-- è¾“å‡ºåŒºåŸŸ -->
    <rect x="700" y="55" width="780" height="190" rx="8" fill="#fef3c7" stroke="#f59e0b" stroke-width="1"/>
    <text x="720" y="78" fill="#92400e" font-size="14" font-family="Arial, sans-serif" font-weight="bold">ğŸ“¤ è¾“å‡ºç»“æœ (JSON â†’ TaskPlan)</text>

    <text x="720" y="100" fill="#78350f" font-size="11" font-family="monospace" font-weight="bold">task_understanding:</text>
    <text x="740" y="115" fill="#713f12" font-size="10" font-family="monospace">core_objective, expected_output, key_dimensions, target_audience</text>

    <text x="720" y="135" fill="#78350f" font-size="11" font-family="monospace" font-weight="bold">subtasks[] (SubTask):</text>
    <rect x="740" y="145" width="110" height="18" rx="3" fill="url(#outputGrad)"/>
    <text x="795" y="158" text-anchor="middle" fill="#78350f" font-size="10" font-family="monospace">id</text>
    <rect x="860" y="145" width="110" height="18" rx="3" fill="url(#outputGrad)"/>
    <text x="915" y="158" text-anchor="middle" fill="#78350f" font-size="10" font-family="monospace">name</text>
    <rect x="980" y="145" width="130" height="18" rx="3" fill="url(#outputGrad)"/>
    <text x="1045" y="158" text-anchor="middle" fill="#78350f" font-size="10" font-family="monospace">description</text>
    <rect x="1120" y="145" width="130" height="18" rx="3" fill="url(#outputGrad)"/>
    <text x="1185" y="158" text-anchor="middle" fill="#78350f" font-size="10" font-family="monospace">search_queries[]</text>
    <rect x="1260" y="145" width="100" height="18" rx="3" fill="url(#outputGrad)"/>
    <text x="1310" y="158" text-anchor="middle" fill="#78350f" font-size="10" font-family="monospace">priority</text>
    <rect x="1370" y="145" width="90" height="18" rx="3" fill="url(#outputGrad)"/>
    <text x="1415" y="158" text-anchor="middle" fill="#78350f" font-size="10" font-family="monospace">expected_output</text>

    <text x="720" y="185" fill="#78350f" font-size="11" font-family="monospace" font-weight="bold">report_structure:</text>
    <text x="740" y="200" fill="#713f12" font-size="10" font-family="monospace">title, sections[]</text>

    <text x="720" y="230" fill="#dc2626" font-size="11" font-family="Arial, sans-serif" font-weight="bold">
      â¬‡ï¸ ä¼ é€’ç»™: STEP 2 (SearchWorker) å’Œ STEP 3 (SYNTHESIS_PROMPT)
    </text>
  </g>

  <!-- è¿æ¥çº¿ -->
  <path d="M 800,520 L 800,560" stroke="#667eea" stroke-width="2" marker-end="url(#arrow)"/>

  <!-- ==================== STEP 2: SEARCH_WORKER_TASK_PROMPT ==================== -->
  <g transform="translate(50, 570)">
    <rect x="0" y="0" width="1500" height="280" rx="10" fill="white" stroke="#4facfe" stroke-width="2" filter="url(#shadow)"/>

    <!-- æ ‡é¢˜ -->
    <rect x="0" y="0" width="1500" height="40" rx="10" fill="#4facfe"/>
    <text x="30" y="28" fill="white" font-size="16" font-family="Arial, sans-serif" font-weight="bold">
      STEP 2: SEARCH_WORKER_TASK_PROMPT (æœç´¢åˆ†æ) - å¹¶è¡Œæ‰§è¡Œ N ä¸ª Worker
    </text>
    <text x="1180" y="28" fill="#e0f2fe" font-size="12" font-family="monospace">workers.SearchWorker.execute()</text>

    <!-- è¾“å…¥åŒºåŸŸ -->
    <rect x="20" y="55" width="480" height="210" rx="8" fill="#ecfdf5" stroke="#10b981" stroke-width="1"/>
    <text x="40" y="78" fill="#047857" font-size="14" font-family="Arial, sans-serif" font-weight="bold">ğŸ“¥ è¾“å…¥å˜é‡</text>

    <rect x="40" y="90" width="90" height="20" rx="4" fill="url(#inputGrad)"/>
    <text x="85" y="105" text-anchor="middle" fill="#065f46" font-size="10" font-family="monospace">{task_id}</text>
    <text x="140" y="105" fill="#374151" font-size="10" font-family="Arial, sans-serif">â† subtasks[i].id (STEP1)</text>

    <rect x="40" y="115" width="100" height="20" rx="4" fill="url(#inputGrad)"/>
    <text x="90" y="130" text-anchor="middle" fill="#065f46" font-size="10" font-family="monospace">{task_name}</text>
    <text x="150" y="130" fill="#374151" font-size="10" font-family="Arial, sans-serif">â† subtasks[i].name (STEP1)</text>

    <rect x="40" y="140" width="130" height="20" rx="4" fill="url(#inputGrad)"/>
    <text x="105" y="155" text-anchor="middle" fill="#065f46" font-size="10" font-family="monospace">{task_description}</text>
    <text x="180" y="155" fill="#374151" font-size="10" font-family="Arial, sans-serif">â† subtasks[i].description (STEP1)</text>

    <rect x="40" y="165" width="130" height="20" rx="4" fill="url(#inputGrad)"/>
    <text x="105" y="180" text-anchor="middle" fill="#065f46" font-size="10" font-family="monospace">{search_queries}</text>
    <text x="180" y="180" fill="#374151" font-size="10" font-family="Arial, sans-serif">â† subtasks[i].search_queries (STEP1)</text>

    <rect x="40" y="190" width="140" height="20" rx="4" fill="url(#inputGrad)"/>
    <text x="110" y="205" text-anchor="middle" fill="#065f46" font-size="10" font-family="monospace">{expected_output}</text>
    <text x="190" y="205" fill="#374151" font-size="10" font-family="Arial, sans-serif">â† subtasks[i].expected_output (STEP1)</text>

    <rect x="40" y="215" width="130" height="20" rx="4" fill="#fbbf24"/>
    <text x="105" y="230" text-anchor="middle" fill="#78350f" font-size="10" font-family="monospace">{search_results}</text>
    <text x="180" y="230" fill="#374151" font-size="10" font-family="Arial, sans-serif">â† SearchClient.search() å®æ—¶è·å–</text>

    <text x="40" y="255" fill="#6b7280" font-size="10" font-family="Arial, sans-serif">æ¥æº: STEP 1 è¾“å‡ºçš„ subtasks + Bocha API æœç´¢ç»“æœ</text>

    <!-- LLMå¤„ç† -->
    <rect x="520" y="55" width="200" height="100" rx="8" fill="url(#llmGrad)"/>
    <text x="620" y="85" text-anchor="middle" fill="white" font-size="14" font-family="Arial, sans-serif" font-weight="bold">ğŸ¤– LLM å¤„ç†</text>
    <text x="620" y="108" text-anchor="middle" fill="#fce7f3" font-size="10" font-family="Arial, sans-serif">æå–å…³é”®ä¿¡æ¯</text>
    <text x="620" y="123" text-anchor="middle" fill="#fce7f3" font-size="10" font-family="Arial, sans-serif">è¯„ä¼°æ¥æºå¯é æ€§</text>
    <text x="620" y="138" text-anchor="middle" fill="#fce7f3" font-size="10" font-family="Arial, sans-serif">ç”Ÿæˆæ´å¯Ÿåˆ†æ</text>

    <!-- ç®­å¤´ -->
    <line x1="500" y1="110" x2="515" y2="110" stroke="#667eea" stroke-width="2" marker-end="url(#arrow)"/>
    <line x1="720" y1="110" x2="755" y2="110" stroke="#fa709a" stroke-width="2" marker-end="url(#arrow-orange)"/>

    <!-- è¾“å‡ºåŒºåŸŸ -->
    <rect x="760" y="55" width="720" height="210" rx="8" fill="#fef3c7" stroke="#f59e0b" stroke-width="1"/>
    <text x="780" y="78" fill="#92400e" font-size="14" font-family="Arial, sans-serif" font-weight="bold">ğŸ“¤ è¾“å‡ºç»“æœ (JSON â†’ worker_results[])</text>

    <rect x="780" y="90" width="120" height="18" rx="3" fill="url(#outputGrad)"/>
    <text x="840" y="103" text-anchor="middle" fill="#78350f" font-size="10" font-family="monospace">key_findings[]</text>
    <text x="910" y="103" fill="#713f12" font-size="10" font-family="Arial, sans-serif">finding, data, source, source_url, reliability, date</text>

    <rect x="780" y="115" width="100" height="18" rx="3" fill="url(#outputGrad)"/>
    <text x="830" y="128" text-anchor="middle" fill="#78350f" font-size="10" font-family="monospace">summary</text>
    <text x="890" y="128" fill="#713f12" font-size="10" font-family="Arial, sans-serif">æœ¬ä»»åŠ¡çš„ç ”ç©¶æ€»ç»“ (200-500å­—)</text>

    <rect x="780" y="140" width="110" height="18" rx="3" fill="url(#outputGrad)"/>
    <text x="835" y="153" text-anchor="middle" fill="#78350f" font-size="10" font-family="monospace">data_points[]</text>
    <text x="900" y="153" fill="#713f12" font-size="10" font-family="Arial, sans-serif">metric, value, source (ç»“æ„åŒ–æ•°æ®ç‚¹)</text>

    <rect x="780" y="165" width="90" height="18" rx="3" fill="url(#outputGrad)"/>
    <text x="825" y="178" text-anchor="middle" fill="#78350f" font-size="10" font-family="monospace">insights[]</text>
    <text x="880" y="178" fill="#713f12" font-size="10" font-family="Arial, sans-serif">æ´å¯Ÿåˆ—è¡¨</text>

    <rect x="780" y="190" width="100" height="18" rx="3" fill="url(#outputGrad)"/>
    <text x="830" y="203" text-anchor="middle" fill="#78350f" font-size="10" font-family="monospace">limitations</text>
    <text x="890" y="203" fill="#713f12" font-size="10" font-family="Arial, sans-serif">ç ”ç©¶å±€é™æ€§</text>

    <rect x="780" y="215" width="130" height="18" rx="3" fill="url(#outputGrad)"/>
    <text x="845" y="228" text-anchor="middle" fill="#78350f" font-size="10" font-family="monospace">confidence_level</text>
    <text x="920" y="228" fill="#713f12" font-size="10" font-family="Arial, sans-serif">high/medium/low</text>

    <text x="780" y="255" fill="#dc2626" font-size="11" font-family="Arial, sans-serif" font-weight="bold">
      â¬‡ï¸ ä¼ é€’ç»™: STEP 3 ä½œä¸º {worker_results}
    </text>
  </g>

  <!-- è¿æ¥çº¿ -->
  <path d="M 800,850 L 800,890" stroke="#667eea" stroke-width="2" marker-end="url(#arrow)"/>

  <!-- ==================== STEP 3: SYNTHESIS_PROMPT ==================== -->
  <g transform="translate(50, 900)">
    <rect x="0" y="0" width="1500" height="230" rx="10" fill="white" stroke="#667eea" stroke-width="2" filter="url(#shadow)"/>

    <!-- æ ‡é¢˜ -->
    <rect x="0" y="0" width="1500" height="40" rx="10" fill="url(#promptGrad)"/>
    <text x="30" y="28" fill="white" font-size="16" font-family="Arial, sans-serif" font-weight="bold">
      STEP 3: SYNTHESIS_PROMPT (ç»“æœç»¼åˆ)
    </text>
    <text x="1200" y="28" fill="#e0e7ff" font-size="12" font-family="monospace">orchestrator.synthesize_results()</text>

    <!-- è¾“å…¥åŒºåŸŸ -->
    <rect x="20" y="55" width="500" height="160" rx="8" fill="#ecfdf5" stroke="#10b981" stroke-width="1"/>
    <text x="40" y="78" fill="#047857" font-size="14" font-family="Arial, sans-serif" font-weight="bold">ğŸ“¥ è¾“å…¥å˜é‡</text>

    <rect x="40" y="95" width="130" height="20" rx="4" fill="url(#inputGrad)"/>
    <text x="105" y="110" text-anchor="middle" fill="#065f46" font-size="10" font-family="monospace">{original_task}</text>
    <text x="180" y="110" fill="#374151" font-size="10" font-family="Arial, sans-serif">â† ç”¨æˆ·åŸå§‹ä»»åŠ¡ (STEP 0)</text>

    <rect x="40" y="120" width="140" height="20" rx="4" fill="url(#inputGrad)"/>
    <text x="110" y="135" text-anchor="middle" fill="#065f46" font-size="10" font-family="monospace">{report_structure}</text>
    <text x="190" y="135" fill="#374151" font-size="10" font-family="Arial, sans-serif">â† task_plan.report_structure (STEP 1)</text>

    <rect x="40" y="145" width="130" height="20" rx="4" fill="url(#inputGrad)"/>
    <text x="105" y="160" text-anchor="middle" fill="#065f46" font-size="10" font-family="monospace">{worker_results}</text>
    <text x="180" y="160" fill="#374151" font-size="10" font-family="Arial, sans-serif">â† æ‰€æœ‰Workerç»“æœ (STEP 2 æ ¼å¼åŒ–å)</text>

    <text x="40" y="200" fill="#6b7280" font-size="10" font-family="Arial, sans-serif">
      worker_results é€šè¿‡ _format_worker_results() æ ¼å¼åŒ–ä¸ºæ–‡æœ¬
    </text>

    <!-- LLMå¤„ç† -->
    <rect x="540" y="55" width="200" height="100" rx="8" fill="url(#llmGrad)"/>
    <text x="640" y="85" text-anchor="middle" fill="white" font-size="14" font-family="Arial, sans-serif" font-weight="bold">ğŸ¤– LLM å¤„ç†</text>
    <text x="640" y="108" text-anchor="middle" fill="#fce7f3" font-size="10" font-family="Arial, sans-serif">æŒ‰æŠ¥å‘Šç»“æ„ç»„ç»‡å†…å®¹</text>
    <text x="640" y="123" text-anchor="middle" fill="#fce7f3" font-size="10" font-family="Arial, sans-serif">æ·»åŠ å¼•ç”¨ç¼–å· [1][2]</text>
    <text x="640" y="138" text-anchor="middle" fill="#fce7f3" font-size="10" font-family="Arial, sans-serif">ç”Ÿæˆå‚è€ƒæ¥æºç« èŠ‚</text>

    <!-- ç®­å¤´ -->
    <line x1="520" y1="105" x2="535" y2="105" stroke="#667eea" stroke-width="2" marker-end="url(#arrow)"/>
    <line x1="740" y1="105" x2="775" y2="105" stroke="#fa709a" stroke-width="2" marker-end="url(#arrow-orange)"/>

    <!-- è¾“å‡ºåŒºåŸŸ -->
    <rect x="780" y="55" width="700" height="160" rx="8" fill="#fef3c7" stroke="#f59e0b" stroke-width="1"/>
    <text x="800" y="78" fill="#92400e" font-size="14" font-family="Arial, sans-serif" font-weight="bold">ğŸ“¤ è¾“å‡ºç»“æœ (Markdown String)</text>

    <rect x="800" y="95" width="150" height="20" rx="4" fill="url(#outputGrad)"/>
    <text x="875" y="110" text-anchor="middle" fill="#78350f" font-size="11" font-family="monospace">current_report</text>
    <text x="960" y="110" fill="#713f12" font-size="11" font-family="Arial, sans-serif">å®Œæ•´çš„ Markdown ç ”ç©¶æŠ¥å‘Š</text>

    <text x="800" y="140" fill="#713f12" font-size="11" font-family="Arial, sans-serif">æŠ¥å‘Šç»“æ„: æ‰§è¡Œæ‘˜è¦ â†’ å„ç« èŠ‚å†…å®¹ â†’ ç»“è®ºå»ºè®® â†’ å‚è€ƒæ¥æº</text>
    <text x="800" y="160" fill="#713f12" font-size="11" font-family="Arial, sans-serif">åŒ…å«: å¼•ç”¨æ ‡æ³¨ [1]ã€è¡¨æ ¼ã€ç²—ä½“æ•°æ®ã€æ¥æºåˆ—è¡¨</text>

    <text x="800" y="195" fill="#dc2626" font-size="11" font-family="Arial, sans-serif" font-weight="bold">
      â¬‡ï¸ ä¼ é€’ç»™: STEP 4 ä½œä¸º {report} å’Œåç»­æ­¥éª¤ä½œä¸º {original_report}
    </text>
  </g>

  <!-- è¿­ä»£å¾ªç¯æ ‡è®° -->
  <rect x="30" y="1140" width="1540" height="30" rx="5" fill="#fef3c7" stroke="#f59e0b" stroke-width="2"/>
  <text x="800" y="1160" text-anchor="middle" fill="#92400e" font-size="14" font-family="Arial, sans-serif" font-weight="bold">
    ğŸ”„ ä»¥ä¸‹ STEP 4-7 åœ¨è¿­ä»£å¾ªç¯ä¸­æ‰§è¡Œ (æœ€å°‘2è½®ï¼Œæœ€å¤š5è½®ï¼Œç›´åˆ° quality_score â‰¥ 80)
  </text>

  <!-- è¿æ¥çº¿ -->
  <path d="M 800,1130 L 800,1185" stroke="#667eea" stroke-width="2" marker-end="url(#arrow)"/>

  <!-- ==================== STEP 4: QUALITY_CHECK_PROMPT ==================== -->
  <g transform="translate(50, 1190)">
    <rect x="0" y="0" width="1500" height="200" rx="10" fill="white" stroke="#8b5cf6" stroke-width="2" filter="url(#shadow)"/>

    <!-- æ ‡é¢˜ -->
    <rect x="0" y="0" width="1500" height="40" rx="10" fill="#8b5cf6"/>
    <text x="30" y="28" fill="white" font-size="16" font-family="Arial, sans-serif" font-weight="bold">
      STEP 4: QUALITY_CHECK_PROMPT (è´¨é‡æ£€æŸ¥)
    </text>
    <text x="1200" y="28" fill="#ede9fe" font-size="12" font-family="monospace">orchestrator.check_quality()</text>

    <!-- è¾“å…¥åŒºåŸŸ -->
    <rect x="20" y="55" width="400" height="130" rx="8" fill="#ecfdf5" stroke="#10b981" stroke-width="1"/>
    <text x="40" y="78" fill="#047857" font-size="14" font-family="Arial, sans-serif" font-weight="bold">ğŸ“¥ è¾“å…¥å˜é‡</text>

    <rect x="40" y="95" width="80" height="20" rx="4" fill="url(#inputGrad)"/>
    <text x="80" y="110" text-anchor="middle" fill="#065f46" font-size="10" font-family="monospace">{report}</text>
    <text x="130" y="110" fill="#374151" font-size="10" font-family="Arial, sans-serif">â† current_report (STEP 3 æˆ–ä¸Šä¸€è½® STEP 7)</text>

    <rect x="40" y="120" width="130" height="20" rx="4" fill="url(#inputGrad)"/>
    <text x="105" y="135" text-anchor="middle" fill="#065f46" font-size="10" font-family="monospace">{original_task}</text>
    <text x="180" y="135" fill="#374151" font-size="10" font-family="Arial, sans-serif">â† ç”¨æˆ·åŸå§‹ä»»åŠ¡ (STEP 0)</text>

    <text x="40" y="170" fill="#6b7280" font-size="10" font-family="Arial, sans-serif">
      é¦–è½®: report æ¥è‡ª STEP 3; åç»­è½®: æ¥è‡ª STEP 7 çš„ refined_report
    </text>

    <!-- LLMå¤„ç† -->
    <rect x="440" y="55" width="200" height="100" rx="8" fill="url(#llmGrad)"/>
    <text x="540" y="85" text-anchor="middle" fill="white" font-size="14" font-family="Arial, sans-serif" font-weight="bold">ğŸ¤– LLM å¤„ç†</text>
    <text x="540" y="108" text-anchor="middle" fill="#fce7f3" font-size="10" font-family="Arial, sans-serif">è¯„ä¼°5ä¸ªç»´åº¦</text>
    <text x="540" y="123" text-anchor="middle" fill="#fce7f3" font-size="10" font-family="Arial, sans-serif">ç”Ÿæˆ0-100åˆ†æ•°</text>
    <text x="540" y="138" text-anchor="middle" fill="#fce7f3" font-size="10" font-family="Arial, sans-serif">è¯†åˆ«ç¼ºå¤±æ–¹é¢</text>

    <!-- ç®­å¤´ -->
    <line x1="420" y1="105" x2="435" y2="105" stroke="#667eea" stroke-width="2" marker-end="url(#arrow)"/>
    <line x1="640" y1="105" x2="675" y2="105" stroke="#fa709a" stroke-width="2" marker-end="url(#arrow-orange)"/>

    <!-- è¾“å‡ºåŒºåŸŸ -->
    <rect x="680" y="55" width="800" height="130" rx="8" fill="#fef3c7" stroke="#f59e0b" stroke-width="1"/>
    <text x="700" y="78" fill="#92400e" font-size="14" font-family="Arial, sans-serif" font-weight="bold">ğŸ“¤ è¾“å‡ºç»“æœ (JSON â†’ quality_result)</text>

    <rect x="700" y="95" width="110" height="18" rx="3" fill="url(#outputGrad)"/>
    <text x="755" y="108" text-anchor="middle" fill="#78350f" font-size="10" font-family="monospace">overall_score</text>
    <text x="820" y="108" fill="#713f12" font-size="10" font-family="Arial, sans-serif">0-100 æ€»åˆ† (å†³å®šæ˜¯å¦ç»§ç»­è¿­ä»£)</text>

    <rect x="700" y="118" width="100" height="18" rx="3" fill="url(#outputGrad)"/>
    <text x="750" y="131" text-anchor="middle" fill="#78350f" font-size="10" font-family="monospace">dimensions</text>
    <text x="810" y="131" fill="#713f12" font-size="10" font-family="Arial, sans-serif">completeness, accuracy, depth, structure, readability</text>

    <rect x="700" y="141" width="130" height="18" rx="3" fill="url(#outputGrad)"/>
    <text x="765" y="154" text-anchor="middle" fill="#78350f" font-size="10" font-family="monospace">missing_aspects[]</text>
    <text x="840" y="154" fill="#713f12" font-size="10" font-family="Arial, sans-serif">ç¼ºå¤±çš„æ–¹é¢åˆ—è¡¨</text>

    <rect x="1050" y="95" width="180" height="18" rx="3" fill="url(#outputGrad)"/>
    <text x="1140" y="108" text-anchor="middle" fill="#78350f" font-size="10" font-family="monospace">improvement_suggestions[]</text>

    <rect x="1050" y="118" width="130" height="18" rx="3" fill="url(#outputGrad)"/>
    <text x="1115" y="131" text-anchor="middle" fill="#78350f" font-size="10" font-family="monospace">needs_revision</text>
    <text x="1190" y="131" fill="#713f12" font-size="10" font-family="Arial, sans-serif">true/false</text>

    <text x="700" y="175" fill="#dc2626" font-size="11" font-family="Arial, sans-serif" font-weight="bold">
      â¬‡ï¸ ä¼ é€’ç»™: STEP 5 ä½œä¸º {quality_result}; ç”¨äºåˆ¤æ–­è¿­ä»£ç»ˆæ­¢æ¡ä»¶
    </text>
  </g>

  <!-- è¿æ¥çº¿ -->
  <path d="M 800,1390 L 800,1420" stroke="#667eea" stroke-width="2" marker-end="url(#arrow)"/>

  <!-- ==================== STEP 5: GAP_ANALYSIS_PROMPT ==================== -->
  <g transform="translate(50, 1430)">
    <rect x="0" y="0" width="1500" height="230" rx="10" fill="white" stroke="#ec4899" stroke-width="2" filter="url(#shadow)"/>

    <!-- æ ‡é¢˜ -->
    <rect x="0" y="0" width="1500" height="40" rx="10" fill="#ec4899"/>
    <text x="30" y="28" fill="white" font-size="16" font-family="Arial, sans-serif" font-weight="bold">
      STEP 5: GAP_ANALYSIS_PROMPT (ç¼ºå£åˆ†æ)
    </text>
    <text x="1200" y="28" fill="#fce7f3" font-size="12" font-family="monospace">orchestrator.analyze_gaps()</text>

    <!-- è¾“å…¥åŒºåŸŸ -->
    <rect x="20" y="55" width="450" height="160" rx="8" fill="#ecfdf5" stroke="#10b981" stroke-width="1"/>
    <text x="40" y="78" fill="#047857" font-size="14" font-family="Arial, sans-serif" font-weight="bold">ğŸ“¥ è¾“å…¥å˜é‡</text>

    <rect x="40" y="95" width="130" height="18" rx="4" fill="url(#inputGrad)"/>
    <text x="105" y="108" text-anchor="middle" fill="#065f46" font-size="10" font-family="monospace">{original_task}</text>
    <text x="180" y="108" fill="#374151" font-size="10" font-family="Arial, sans-serif">â† ç”¨æˆ·åŸå§‹ä»»åŠ¡ (STEP 0)</text>

    <rect x="40" y="118" width="130" height="18" rx="4" fill="url(#inputGrad)"/>
    <text x="105" y="131" text-anchor="middle" fill="#065f46" font-size="10" font-family="monospace">{current_report}</text>
    <text x="180" y="131" fill="#374151" font-size="10" font-family="Arial, sans-serif">â† å½“å‰æŠ¥å‘Š (STEP 3 æˆ– STEP 7)</text>

    <rect x="40" y="141" width="120" height="18" rx="4" fill="url(#inputGrad)"/>
    <text x="100" y="154" text-anchor="middle" fill="#065f46" font-size="10" font-family="monospace">{quality_result}</text>
    <text x="170" y="154" fill="#374151" font-size="10" font-family="Arial, sans-serif">â† STEP 4 è´¨é‡æ£€æŸ¥ç»“æœ (JSON)</text>

    <rect x="40" y="164" width="90" height="18" rx="4" fill="url(#inputGrad)"/>
    <text x="85" y="177" text-anchor="middle" fill="#065f46" font-size="10" font-family="monospace">{iteration}</text>
    <text x="140" y="177" fill="#374151" font-size="10" font-family="Arial, sans-serif">â† å½“å‰è¿­ä»£æ¬¡æ•° (1,2,3...)</text>

    <rect x="40" y="187" width="120" height="18" rx="4" fill="url(#inputGrad)"/>
    <text x="100" y="200" text-anchor="middle" fill="#065f46" font-size="10" font-family="monospace">{max_iterations}</text>
    <text x="170" y="200" fill="#374151" font-size="10" font-family="Arial, sans-serif">â† æœ€å¤§è¿­ä»£æ¬¡æ•° (é»˜è®¤5)</text>

    <!-- LLMå¤„ç† -->
    <rect x="490" y="55" width="200" height="100" rx="8" fill="url(#llmGrad)"/>
    <text x="590" y="85" text-anchor="middle" fill="white" font-size="14" font-family="Arial, sans-serif" font-weight="bold">ğŸ¤– LLM å¤„ç†</text>
    <text x="590" y="108" text-anchor="middle" fill="#fce7f3" font-size="10" font-family="Arial, sans-serif">è¯†åˆ«å†…å®¹ç¼ºå£</text>
    <text x="590" y="123" text-anchor="middle" fill="#fce7f3" font-size="10" font-family="Arial, sans-serif">ç”Ÿæˆè¡¥å……ä»»åŠ¡</text>
    <text x="590" y="138" text-anchor="middle" fill="#fce7f3" font-size="10" font-family="Arial, sans-serif">ç¡®å®šä¿®è®¢é‡ç‚¹</text>

    <!-- ç®­å¤´ -->
    <line x1="470" y1="105" x2="485" y2="105" stroke="#667eea" stroke-width="2" marker-end="url(#arrow)"/>
    <line x1="690" y1="105" x2="725" y2="105" stroke="#fa709a" stroke-width="2" marker-end="url(#arrow-orange)"/>

    <!-- è¾“å‡ºåŒºåŸŸ -->
    <rect x="730" y="55" width="750" height="160" rx="8" fill="#fef3c7" stroke="#f59e0b" stroke-width="1"/>
    <text x="750" y="78" fill="#92400e" font-size="14" font-family="Arial, sans-serif" font-weight="bold">ğŸ“¤ è¾“å‡ºç»“æœ (JSON)</text>

    <rect x="750" y="95" width="110" height="18" rx="3" fill="url(#outputGrad)"/>
    <text x="805" y="108" text-anchor="middle" fill="#78350f" font-size="10" font-family="monospace">gap_analysis</text>
    <text x="870" y="108" fill="#713f12" font-size="10" font-family="Arial, sans-serif">missing_aspects, weak_sections, missing_data, shallow_analysis</text>

    <rect x="750" y="118" width="160" height="18" rx="3" fill="url(#outputGrad)"/>
    <text x="830" y="131" text-anchor="middle" fill="#78350f" font-size="10" font-family="monospace">supplementary_tasks[]</text>
    <text x="920" y="131" fill="#713f12" font-size="10" font-family="Arial, sans-serif">id, name, description, search_queries, target_gap, priority</text>

    <rect x="750" y="141" width="140" height="18" rx="3" fill="url(#outputGrad)"/>
    <text x="820" y="154" text-anchor="middle" fill="#78350f" font-size="10" font-family="monospace">refinement_focus[]</text>
    <text x="900" y="154" fill="#713f12" font-size="10" font-family="Arial, sans-serif">æŠ¥å‘Šä¿®è®¢é‡ç‚¹åˆ—è¡¨</text>

    <text x="750" y="185" fill="#dc2626" font-size="11" font-family="Arial, sans-serif" font-weight="bold">
      â¬‡ï¸ gap_analysis â†’ STEP 7; supplementary_tasks â†’ STEP 6; refinement_focus â†’ STEP 7
    </text>
    <text x="750" y="205" fill="#059669" font-size="11" font-family="Arial, sans-serif" font-weight="bold">
      ğŸ’¡ è¿™å°±æ˜¯ä½ é—®çš„ {gap_analysis} çš„æ¥æºï¼
    </text>
  </g>

  <!-- è¿æ¥çº¿ -->
  <path d="M 800,1660 L 800,1690" stroke="#667eea" stroke-width="2" marker-end="url(#arrow)"/>

  <!-- ==================== STEP 6: è¡¥å……æœç´¢ ==================== -->
  <g transform="translate(50, 1700)">
    <rect x="0" y="0" width="1500" height="150" rx="10" fill="white" stroke="#4facfe" stroke-width="2" filter="url(#shadow)"/>

    <!-- æ ‡é¢˜ -->
    <rect x="0" y="0" width="1500" height="40" rx="10" fill="#4facfe"/>
    <text x="30" y="28" fill="white" font-size="16" font-family="Arial, sans-serif" font-weight="bold">
      STEP 6: è¡¥å……ç ”ç©¶ (å¤ç”¨ SEARCH_WORKER_TASK_PROMPT)
    </text>
    <text x="1150" y="28" fill="#e0f2fe" font-size="12" font-family="monospace">orchestrator.dispatch_supplementary_workers()</text>

    <!-- è¾“å…¥ -->
    <rect x="20" y="55" width="500" height="80" rx="8" fill="#ecfdf5" stroke="#10b981" stroke-width="1"/>
    <text x="40" y="78" fill="#047857" font-size="14" font-family="Arial, sans-serif" font-weight="bold">ğŸ“¥ è¾“å…¥</text>
    <rect x="40" y="95" width="160" height="20" rx="4" fill="url(#inputGrad)"/>
    <text x="120" y="110" text-anchor="middle" fill="#065f46" font-size="10" font-family="monospace">supplementary_tasks[]</text>
    <text x="210" y="110" fill="#374151" font-size="10" font-family="Arial, sans-serif">â† STEP 5 è¾“å‡ºçš„è¡¥å……ä»»åŠ¡åˆ—è¡¨</text>

    <!-- å¤„ç† -->
    <rect x="560" y="55" width="200" height="80" rx="8" fill="url(#llmGrad)"/>
    <text x="660" y="85" text-anchor="middle" fill="white" font-size="14" font-family="Arial, sans-serif" font-weight="bold">ğŸ” æœç´¢ + ğŸ¤– åˆ†æ</text>
    <text x="660" y="108" text-anchor="middle" fill="#fce7f3" font-size="10" font-family="Arial, sans-serif">æ‰§è¡Œé’ˆå¯¹æ€§æœç´¢</text>
    <text x="660" y="123" text-anchor="middle" fill="#fce7f3" font-size="10" font-family="Arial, sans-serif">æå–è¡¥å……ä¿¡æ¯</text>

    <!-- ç®­å¤´ -->
    <line x1="520" y1="95" x2="555" y2="95" stroke="#667eea" stroke-width="2" marker-end="url(#arrow)"/>
    <line x1="760" y1="95" x2="795" y2="95" stroke="#fa709a" stroke-width="2" marker-end="url(#arrow-orange)"/>

    <!-- è¾“å‡º -->
    <rect x="800" y="55" width="680" height="80" rx="8" fill="#fef3c7" stroke="#f59e0b" stroke-width="1"/>
    <text x="820" y="78" fill="#92400e" font-size="14" font-family="Arial, sans-serif" font-weight="bold">ğŸ“¤ è¾“å‡º</text>
    <rect x="820" y="95" width="170" height="20" rx="4" fill="url(#outputGrad)"/>
    <text x="905" y="110" text-anchor="middle" fill="#78350f" font-size="10" font-family="monospace">supplementary_results[]</text>
    <text x="1000" y="110" fill="#713f12" font-size="10" font-family="Arial, sans-serif">â† ç»“æ„åŒ STEP 2 çš„ worker_results</text>

    <text x="820" y="130" fill="#dc2626" font-size="11" font-family="Arial, sans-serif" font-weight="bold">
      â¬‡ï¸ ä¼ é€’ç»™: STEP 7 ä½œä¸º {supplementary_results}
    </text>
  </g>

  <!-- è¿æ¥çº¿ -->
  <path d="M 800,1850 L 800,1880" stroke="#667eea" stroke-width="2" marker-end="url(#arrow)"/>

  <!-- ==================== STEP 7: REPORT_REFINEMENT_PROMPT ==================== -->
  <g transform="translate(50, 1890)">
    <rect x="0" y="0" width="1500" height="250" rx="10" fill="white" stroke="#f59e0b" stroke-width="2" filter="url(#shadow)"/>

    <!-- æ ‡é¢˜ -->
    <rect x="0" y="0" width="1500" height="40" rx="10" fill="#f59e0b"/>
    <text x="30" y="28" fill="white" font-size="16" font-family="Arial, sans-serif" font-weight="bold">
      STEP 7: REPORT_REFINEMENT_PROMPT (æŠ¥å‘Šä¼˜åŒ–)
    </text>
    <text x="1200" y="28" fill="#fef3c7" font-size="12" font-family="monospace">orchestrator.refine_report()</text>

    <!-- è¾“å…¥åŒºåŸŸ -->
    <rect x="20" y="55" width="500" height="180" rx="8" fill="#ecfdf5" stroke="#10b981" stroke-width="1"/>
    <text x="40" y="78" fill="#047857" font-size="14" font-family="Arial, sans-serif" font-weight="bold">ğŸ“¥ è¾“å…¥å˜é‡</text>

    <rect x="40" y="95" width="130" height="18" rx="4" fill="url(#inputGrad)"/>
    <text x="105" y="108" text-anchor="middle" fill="#065f46" font-size="10" font-family="monospace">{original_task}</text>
    <text x="180" y="108" fill="#374151" font-size="10" font-family="Arial, sans-serif">â† ç”¨æˆ·åŸå§‹ä»»åŠ¡ (STEP 0)</text>

    <rect x="40" y="118" width="130" height="18" rx="4" fill="url(#inputGrad)"/>
    <text x="105" y="131" text-anchor="middle" fill="#065f46" font-size="10" font-family="monospace">{original_report}</text>
    <text x="180" y="131" fill="#374151" font-size="10" font-family="Arial, sans-serif">â† å½“å‰æŠ¥å‘Š (STEP 3 æˆ–ä¸Šè½® STEP 7)</text>

    <rect x="40" y="141" width="110" height="18" rx="4" fill="#f472b6"/>
    <text x="95" y="154" text-anchor="middle" fill="white" font-size="10" font-family="monospace">{gap_analysis}</text>
    <text x="160" y="154" fill="#be185d" font-size="10" font-family="Arial, sans-serif" font-weight="bold">â† STEP 5 è¾“å‡ºçš„ gap_analysis å¯¹è±¡!</text>

    <rect x="40" y="164" width="170" height="18" rx="4" fill="url(#inputGrad)"/>
    <text x="125" y="177" text-anchor="middle" fill="#065f46" font-size="10" font-family="monospace">{supplementary_results}</text>
    <text x="220" y="177" fill="#374151" font-size="10" font-family="Arial, sans-serif">â† STEP 6 è¾“å‡ºçš„è¡¥å……ç ”ç©¶ç»“æœ</text>

    <rect x="40" y="187" width="140" height="18" rx="4" fill="url(#inputGrad)"/>
    <text x="110" y="200" text-anchor="middle" fill="#065f46" font-size="10" font-family="monospace">{refinement_focus}</text>
    <text x="190" y="200" fill="#374151" font-size="10" font-family="Arial, sans-serif">â† STEP 5 è¾“å‡ºçš„ä¿®è®¢é‡ç‚¹åˆ—è¡¨</text>

    <!-- LLMå¤„ç† -->
    <rect x="540" y="55" width="200" height="120" rx="8" fill="url(#llmGrad)"/>
    <text x="640" y="85" text-anchor="middle" fill="white" font-size="14" font-family="Arial, sans-serif" font-weight="bold">ğŸ¤– LLM å¤„ç†</text>
    <text x="640" y="108" text-anchor="middle" fill="#fce7f3" font-size="10" font-family="Arial, sans-serif">æ•´åˆæ–°å‘ç°åˆ°æŠ¥å‘Š</text>
    <text x="640" y="123" text-anchor="middle" fill="#fce7f3" font-size="10" font-family="Arial, sans-serif">å¼ºåŒ–è–„å¼±ç« èŠ‚</text>
    <text x="640" y="138" text-anchor="middle" fill="#fce7f3" font-size="10" font-family="Arial, sans-serif">æ›´æ–°æ•°æ®å’Œå¼•ç”¨</text>
    <text x="640" y="153" text-anchor="middle" fill="#fce7f3" font-size="10" font-family="Arial, sans-serif">ä¿æŒé£æ ¼ä¸€è‡´</text>

    <!-- ç®­å¤´ -->
    <line x1="520" y1="115" x2="535" y2="115" stroke="#667eea" stroke-width="2" marker-end="url(#arrow)"/>
    <line x1="740" y1="115" x2="775" y2="115" stroke="#fa709a" stroke-width="2" marker-end="url(#arrow-orange)"/>

    <!-- è¾“å‡ºåŒºåŸŸ -->
    <rect x="780" y="55" width="700" height="180" rx="8" fill="#fef3c7" stroke="#f59e0b" stroke-width="1"/>
    <text x="800" y="78" fill="#92400e" font-size="14" font-family="Arial, sans-serif" font-weight="bold">ğŸ“¤ è¾“å‡ºç»“æœ (Markdown String)</text>

    <rect x="800" y="100" width="120" height="22" rx="4" fill="url(#outputGrad)"/>
    <text x="860" y="116" text-anchor="middle" fill="#78350f" font-size="11" font-family="monospace">refined_report</text>
    <text x="930" y="116" fill="#713f12" font-size="11" font-family="Arial, sans-serif">ä¼˜åŒ–åçš„å®Œæ•´ Markdown æŠ¥å‘Š</text>

    <text x="800" y="150" fill="#713f12" font-size="11" font-family="Arial, sans-serif">â€¢ æ–°ä¿¡æ¯å·²æ•´åˆåˆ°ç›¸å…³ç« èŠ‚</text>
    <text x="800" y="168" fill="#713f12" font-size="11" font-family="Arial, sans-serif">â€¢ å¼•ç”¨ç¼–å·å·²æ›´æ–° (æ–°æ¥æºè¿½åŠ åœ¨æœ«å°¾)</text>
    <text x="800" y="186" fill="#713f12" font-size="11" font-family="Arial, sans-serif">â€¢ å‚è€ƒæ¥æºç« èŠ‚å·²æ›´æ–°</text>

    <text x="800" y="220" fill="#dc2626" font-size="11" font-family="Arial, sans-serif" font-weight="bold">
      ğŸ”„ è¿”å› STEP 4 è¿›å…¥ä¸‹ä¸€è½®è¿­ä»£ï¼Œæˆ–ä½œä¸ºæœ€ç»ˆæŠ¥å‘Šè¾“å‡º
    </text>
  </g>

  <!-- è¿­ä»£å¾ªç¯ç®­å¤´ -->
  <path d="M 1530,2000 L 1560,2000 L 1560,1260 L 1530,1260" stroke="#ef4444" stroke-width="3" fill="none" stroke-dasharray="8,4"/>
  <polygon points="1530,1255 1540,1260 1530,1265" fill="#ef4444"/>
  <text x="1565" y="1630" fill="#ef4444" font-size="12" font-family="Arial, sans-serif" font-weight="bold" transform="rotate(90, 1565, 1630)">è¿­ä»£å¾ªç¯</text>

  <!-- æœ€ç»ˆè¾“å‡º -->
  <g transform="translate(50, 2160)">
    <rect x="0" y="0" width="1500" height="100" rx="10" fill="#d1fae5" stroke="#10b981" stroke-width="3" filter="url(#shadow)"/>
    <text x="30" y="35" fill="#047857" font-size="18" font-family="Arial, sans-serif" font-weight="bold">ğŸ‰ æœ€ç»ˆè¾“å‡º</text>
    <text x="30" y="60" fill="#065f46" font-size="14" font-family="Arial, sans-serif">
      å½“ iteration â‰¥ min_iterations (2) ä¸” quality_score â‰¥ threshold (80) æ—¶ï¼Œè¿­ä»£ç»“æŸ
    </text>
    <text x="30" y="85" fill="#065f46" font-size="14" font-family="Arial, sans-serif">
      final_report = æœ€åä¸€è½®çš„ refined_report (Markdown) â†’ ä¿å­˜åˆ°æ–‡ä»¶ + è¿”å›ç»™ç”¨æˆ·
    </text>
  </g>

  <!-- æ•°æ®æµæ€»ç»“ -->
  <g transform="translate(50, 2280)">
    <rect x="0" y="0" width="1500" height="100" rx="10" fill="#fef3c7" stroke="#f59e0b" stroke-width="2" filter="url(#shadow)"/>
    <text x="30" y="30" fill="#92400e" font-size="16" font-family="Arial, sans-serif" font-weight="bold">ğŸ“‹ {gap_analysis} æ•°æ®æµæ€»ç»“</text>
    <text x="30" y="55" fill="#78350f" font-size="13" font-family="Arial, sans-serif">
      STEP 5 (GAP_ANALYSIS_PROMPT) åˆ†ææŠ¥å‘Šç¼ºå£ â†’ è¾“å‡º gap_analysis å¯¹è±¡ (missing_aspects, weak_sections, missing_data, shallow_analysis)
    </text>
    <text x="30" y="78" fill="#78350f" font-size="13" font-family="Arial, sans-serif">
      â†’ STEP 7 (REPORT_REFINEMENT_PROMPT) ä½¿ç”¨ {gap_analysis} å‘Šè¯‰ LLM æŠ¥å‘Šå“ªäº›åœ°æ–¹éœ€è¦åŠ å¼ºï¼ŒæŒ‡å¯¼æŠ¥å‘Šä¼˜åŒ–æ–¹å‘
    </text>
  </g>

</svg>
